<html>
<head>
<title>ElDewrito Server Browser 0.00000001 Pre-Release Alpha Special Collectors Edition</title>
</head>
<body>
<table id="serverlist" style="width:100%">
  <tr>
    <td>Server Name (host player)</td>
    <td>Map</td> 
    <td>Game Type</td>
    <td>Players</td>
  </tr>
</table><br>
<button id="refresh">Refresh</button>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function()
{
   // addServer("127.0.0.1:11775", "Test server", "emoose", "Guardian", "guardian", "Team Slayer", "1", "16");
});

$("#refresh").click(function()
{
    $("#serverlist").find("tr:gt(0)").remove();
    $.getJSON( "http://eldewrito-masterserver-personality.c9.io/list", function( data ) {
        if(data.result.code != 0)
        {
            alert("Error received from master: " + data.result.msg);
            return;
        }
        console.log(data);
        for(var i = 0; i < data.result.servers.length; i++)
        {
            var serverIP = data.result.servers[i];
            console.log(serverIP);
            $.getJSON("http://" + serverIP, function(serverInfo) {
                addServer(serverIP, serverInfo.name, serverInfo.hostPlayer, serverInfo.map, serverInfo.mapFile, serverInfo.variant, serverInfo.numPlayers, serverInfo.maxPlayers);
                console.log(serverInfo);
            });
        }
    });
});

function addServer(ip, name, host, map, mapfile, gamemode, numplayers, maxplayers)
{
    var servName = "<td><a href=\"dorito:" + ip + "\">" + name + " (" + host + ")</a></td>";
    var servMap = "<td>" + map + " (" + mapfile + ")</td>";
    var servType = "<td>" + gamemode + "</td>";
    var servPlayers = "<td>" + numplayers + "/" + maxplayers + "</td>";

    $('#serverlist tr:last').after("<tr id=\"wew\">" + servName + servMap + servType + servPlayers + "</tr>");
}
</script>
</body>
</html>
